<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Work+Sans&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
        <link rel="stylesheet" type="text/css" href="./main.css">
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
            <a class="navbar-brand" href="./index.html"><i class="fas fa-percent brand"></i><span class="title">COVID</span></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class='navbar-nav'>
                    <li class='nav-item'>
                        <a class='nav-link' href="./index.html">Home</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="./check.html">Get Checked</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./about.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./links.html">Links</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="background"></div>
        <div class='container space'></div>
        <div class="container main-content-container" id="covid_check_container">
            <div class='row justify-content-center'>
                <div class='col-11 col-xl-10 main-content'>
                    <div class='form-header text-center'>
                        <h1><i class="fas fa-percent heading-icon"></i>COVID</h1>
                    </div>
                    <br>
                    <h5>
                        Please provide your details below to get an estimated chance of a positive COVID-19 test result.
                        Note that no data is saved from this form. For more info, please see the
                        <strong><a class='inline' href='./about.html'>About</a></strong> section.
                    </h5>
                    <br>
                    <form class='was-validated' id='covid_check_form' action=''>
                        <h3>Basic Details</h3>
                        <div class='row'>
                            <div class='col-12 col-sm-6'>
                                <!-- Age -->
                                <div class='form-group'>
                                    <label for='x_age'>Age:</label>
                                    <input class='form-control' type='number' min=2 max=100 placeholder='Age' name='x_age' required>
                                </div>
                            </div>
                            <div class='col-12 col-sm-6'>
                                <!-- Temperature -->
                                <div class='form-group'>
                                    <label for='x_temp'>Temperature:</label>
                                    <input class='form-control' type='number' min=34 max=42 step='0.1' placeholder='Temperature' name='x_temp' required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class='col-12'>
                                <!-- High Risk Exposure Occupation -->
                                <div class='form-group'>
                                    <label for='x_occupation'>Are you in an occupation that requires frequent interaction with people (e.g. essential services)?</label>
                                    <select class="form-control" name="x_occupation" required>
                                        <option value="" disabled selected>Please select an option:</option>
                                        <option value='0'>No</option>
                                        <option value='1'>Yes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <br>
                        
                        <h3>Symptoms</h3>
                        <div class="row">
                            <div class="col-12">
                                <!-- SYMPTOMS -->
                                <p>
                                    <strong>
                                        Please indicate if you are experiencing any of the following symptoms:
                                    </strong>
                                </p>
                            </div>
                        </div>

                        <!-- SYMPTOMS SECTION -->
                        <div class='row'>
                            <!-- Loss of Smell -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Loss of Smell:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_los" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_los" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Shortness of breath -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Shortness of Breath:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_sob" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_sob" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Loss of Taste -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Loss of Taste:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_lot" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_lot" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Fever -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Fever:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_fever" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_fever" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Runny Nose -->
                            <div class="col-6 col-md-4 col-lg-3 text-center align-content-bottom">
                                <div class='form-group'>
                                    <label>Runny Nose:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_runnynose" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_runnynose" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Sore Throat -->
                            <div class="col-6 col-md-4 col-lg-3 text-center align-content-bottom">
                                <div class='form-group'>
                                    <label>Sore Throat:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_sorethroat" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_sorethroat" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Cough -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Cough:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_cough" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_cough" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Headache -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Headache:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_headache" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_headache" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Diarrhoea -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Diarrhoea:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_diarrhoea" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_diarrhoea" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Muscle Sores -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Muscle Sores:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_musclesores" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_musclesores" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Fatigue -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Fatigue:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_fatigue" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_fatigue" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Unused -->
                            <div class="col-6 col-md-4 col-lg-3 text-center"></div>
                        </div>
                        <br>

                        <!-- ROW 7 -->
                        <h3>Chronic Diseases</h3>
                        <div class="row">
                            <div class="col-12">
                                <!-- SYMPTOMS -->
                                <p>
                                    <strong>
                                        Please indicate if you have any of the following:
                                    </strong>
                                </p>
                            </div>
                        </div>

                        <!-- CHRONIC DISEASES SECTION -->
                        <div class='row align-items-end'>
                            <!-- Diabetes -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Diabetes:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_diabetes" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_diabetes" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Heart Disease -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Heart Disease:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_heartdis" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_heartdis" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Hypertension -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Hypertension:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_hypertension" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_hypertension" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Cancer -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Cancer:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_cancer" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_cancer" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Asthma -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Asthma:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_asthma" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_asthma" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Autoimmune Disease -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Autoimmune Disease:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_autoimmune" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_autoimmune" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- COPD -->
                            <div class="col-6 col-md-4 col-lg-3 text-center">
                                <div class='form-group'>
                                    <label>Chronic Obstructive Lung Disease:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_copd" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_copd" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            

                            <!-- Unused -->
                            <div class="col-6 col-md-4 col-lg-3 text-center"></div>
                        </div>
                        <hr>

                        <!-- FINAL ROW: SUBMIT -->
                        <div class="row">
                            <div class="col-12 text-center">
                                <input type='submit' class='btn btn-lg btn-danger' value='Submit'>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="container text-center main-content-container" id="results">
            <div class='row justify-content-center main-content-container'>
                <div class='col-11 col-sm-10 col-lg-9 main-content'>
                    <h2><span class='results'>Results</span></h2>
                    <p>Probability of a positive COVID-19 test result:</p>
                    <h3 id='result_value'></h3>
                    <br>
                    <button class='btn btn-danger' id='back_to_form'>Back to Form</a>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function(){
                $('#results').hide();
            });

            // Upon submit
            $('#covid_check_form').submit(function(e) {
                
                // Stop
                e.preventDefault();

                // Extract form contents
                var data = {};
                $.each($('#covid_check_form').serializeArray(), function(i, field){
                    data[field.name] = field.value;
                });

                console.log(data);

                // Scale age and temperature
                scaled_age = (data.x_age - 2) / 88;
                scaled_temp = (data.x_temp - 35.65) / 3.7;

                // Compute probability
                wt_int = -1.52876544;
                wt_age = 0.754552 * scaled_age;
                wt_temp = 2.730384 * scaled_temp;
                wt_occ = 0.009848 * data.x_occupation;
                wt_los = 2.320498 * data.x_los;
                wt_sob = - 0.807673 * data.x_sob;
                wt_lot = 0.483565 * data.x_lot;
                wt_fev = 0.603700 * data.x_fever;
                wt_nose = - 0.758933 * data.x_runnynose;
                wt_sore = - 0.897051 * data.x_sorethroat;
                wt_cgh = 0.501331 * data.x_cough;
                wt_hda = 0.235127 * data.x_headache;
                wt_dia = - 1.629448 * data.x_diarrhoea;
                wt_mus = 1.012998 * data.x_musclesores;
                wt_fat = - 0.812958 * data.x_fatigue;
                
                base = wt_int + wt_age + wt_temp + wt_occ + wt_los + wt_sob + wt_lot + wt_fev + wt_nose + wt_sore + wt_cgh + wt_hda + wt_dia + wt_mus + wt_fat;

                odds = Math.exp(base);
                prob = odds / (1 + odds) * 100;

                // Get result
                var result = '';
                
                // Remove prior classes
                $('#result_value').removeClass('risk-low');
                $('#result_value').removeClass('risk-medium');
                $('#result_value').removeClass('risk-high');
                
                // Add class
                if (prob < 35.0){
                    result = 'Low (< 35%)';
                    $('#result_value').addClass('risk-low');
                } else if (prob < 65.0) {
                    result = 'Medium (35-65%)';
                    $('#result_value').addClass('risk-medium');
                } else {
                    result = 'High (> 65%)';
                    $('#result_value').addClass('risk-high');
                }

                $('#result_value').text(function(){
                    return result;
                });

                $('#covid_check_container').fadeOut(500, function(){
                    $('#results').fadeIn(500);

                    // Reset form
                    $('#covid_check_form').trigger('reset');
                    $('label.btn.btn-danger.active').each(function(){
                        $(this).removeClass('active');
                    });
                    $('div.btn-group.btn-group-toggle label:first-child').each(function(){
                        $(this).addClass('active');
                    })
                });
                
                


                // Prevent refresh
                return false;
            });

            $('#back_to_form').on('click', function(){
                $('#results').fadeOut(500, function(){
                    $('#covid_check_container').fadeIn(500);
                });
            });

        </script>
    </body>
</html>