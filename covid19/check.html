<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Work+Sans&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" type="text/css" href="./main.css">
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
            <a class="navbar-brand" href="./index.html">COVID Check</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
          
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class='navbar-nav'>
                    <li class='nav-item'>
                        <a class='nav-link' href="./index.html">Home</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="./check.html">Get Checked</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./about.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./links.html">Links</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="background"></div>
        <div class='container space'></div>

        <div id="barba-wrapper"><div class="barba-container">
        <div class="container main-content-container" id="covid_check_container">
            <div class='row justify-content-center'>
                <div class='col-11 col-sm-10 col-lg-9 main-content'>
                    <h2>COVID Check</h2>
                    <p>Please provide your details to get an estimated chance of a positive COVID-19 test result:</p>
                    <form class='was-validated' id='covid_check_form' action=''>
                        <div class='row'>
                            <div class='col-12 col-sm-6'>
                                <!-- Age -->
                                <div class='form-group'>
                                    <label for='x_age'>Age:</label>
                                    <input class='form-control' type='number' min=2 max=100 placeholder='Age' name='x_age' required>
                                </div>
                            </div>
                            <div class='col-12 col-sm-6'>
                                <!-- Temperature -->
                                <div class='form-group'>
                                    <label for='x_temp'>Temperature:</label>
                                    <input class='form-control' type='number' min=34 max=42 step='0.1' placeholder='Temperature' name='x_temp' required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class='col-12'>
                                <!-- High Risk Exposure Occupation -->
                                <div class='form-group'>
                                    <label for='x_occupation'>Are you in an occupation with high risk exposure (i.e. essential services with frequent interaction with people)?</label>
                                    <select class="form-control" name="x_occupation" required>
                                        <option value="" disabled selected>Please select an option:</option>
                                        <option value='0'>No</option>
                                        <option value='1'>Yes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <!-- SYMPTOMS -->
                                <p>
                                    <strong>
                                        Please indicate if you are experiencing any of the following symptoms:
                                    </strong>
                                </p>
                            </div>
                        </div>

                        <!-- ROW 1 -->
                        <div class='row'>
                            <!-- Loss of Smell -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Loss of Smell:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_los" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_los" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Shortness of breath -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Shortness of Breath:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_sob" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_sob" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <!-- ROW 2 -->
                        <div class='row'>
                            <!-- Loss of Taste -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Loss of Taste:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_lot" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_lot" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Fever -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Fever:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_fever" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_fever" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        
                        <!-- ROW 3 -->
                        <div class='row'>
                            <!-- Runny Nose -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Runny Nose:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_runnynose" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_runnynose" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Sore Throat -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Sore Throat:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_sorethroat" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_sorethroat" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <!-- ROW 4 -->
                        <div class='row'>
                            <!-- Cough -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Cough:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_cough" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_cough" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Headache -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Headache:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_headache" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_headache" value='1' > Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <!-- ROW 5 -->
                        <div class='row'>
                            <!-- Diarrhoea -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Diarrhoea:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_diarrhoea" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_diarrhoea" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Muscle Sores -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Muscle Sores:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_musclesores" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_musclesores" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <!-- ROW 5 -->
                        <div class='row'>
                            <!-- Fatigue -->
                            <div class="col-6 text-center">
                                <div class='form-group'>
                                    <label>Fatigue:</label>
                                    <br>
                                    <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                        <label class="btn btn-danger active">
                                            <input type="radio" name="x_fatigue" value='0' checked> No
                                        </label>
                                        <label class="btn btn-danger">
                                            <input type="radio" name="x_fatigue" value='1'> Yes
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Unused -->
                            <div class="col-6 text-center"></div>
                        </div>
                        <hr>

                        <!-- FINAL ROW: SUBMIT -->
                        <div class="row">
                            <div class="col-12 text-center">
                                <input type='submit' class='btn btn-lg btn-danger' value='Submit'>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="container text-center main-content-container" id="results">
            <div class='row justify-content-center main-content-container'>
                <div class='col-11 col-sm-10 col-lg-9 main-content'>
                    <h2>Results</h2>
                    <p>Probability of a positive COVID-19 test result:</p>
                    <h3 id='result_value'></h3>
                    <br>
                    <button class='btn btn-danger' id='back_to_form'>Back to Form</a>
                </div>
            </div>
        </div>
        </div></div> <!--Barba -->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js" integrity="sha256-H0TPKZAP4+uKmBpntUUMrKgH4VXBQNDZumun6fvan4w=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.6/gsap.min.js"></script>
        <script>
            $(document).ready(function(){
                $('#results').hide();
            });

            // Upon submit
            $('#covid_check_form').submit(function(e) {
                
                // Stop
                e.preventDefault();

                // Extract form contents
                var data = {};
                $.each($('#covid_check_form').serializeArray(), function(i, field){
                    data[field.name] = field.value;
                });

                // Scale age and temperature
                scaled_age = (data.x_age - 2) / 88;
                scaled_temp = (data.x_temp - 35.65) / 3.7;
                
                // Compute probability
                base = -1.52876544 + 0.754552 * scaled_age + 0.009848 * data.x_occupation + 2.320498 * data.x_los - 0.807673 * data.x_sob + 0.483565 * data.x_lot + 0.603700 * data.x_fever - 0.758933 * data.x_runnynose - 0.897051 * data.x_sorethroat + 0.501331 * data.x_cough + 0.235127 * data.x_headache - 1.629448 * data.x_diarrhoea + 1.012998 * data.x_musclesores - 0.812958 * data.x_fatigue;
                odds = Math.exp(base);
                prob = odds / (1 + odds) * 100;
                
                // Get result
                var result = '';
                
                // Remove prior classes
                $('#result_value').removeClass('risk-low');
                $('#result_value').removeClass('risk-medium');
                $('#result_value').removeClass('risk-high');
                
                // Add class
                if (prob < 35){
                    result = 'Low (< 35%)';
                    $('#result_value').addClass('risk-low');
                } else if (prob < 65) {
                    result = 'Medium (35-65%)';
                    $('#result_value').addClass('risk-medium');
                } else {
                    result = 'High (> 65%)';
                    $('#result_value').addClass('risk-high');
                }

                $('#result_value').text(function(){
                    return result;
                });

                $('#covid_check_container').fadeOut(500, function(){
                    $('#results').fadeIn(500);
                });
                
                // Reset form
                $('#covid_check_form').trigger('reset');
                $('label.btn.btn-danger.active').each(function(){
                    $(this).removeClass('active');
                });
                $('div.btn-group.btn-group-toggle label:first-child').each(function(){
                    $(this).addClass('active');
                })


                // Prevent refresh
                return false;
            });

            $('#back_to_form').on('click', function(){
                $('#results').fadeOut(500, function(){
                    $('#covid_check_container').fadeIn(500);
                });
            });

            // Initialise Barba
            Barba.Pjax.start();
        </script>
    </body>
</html>